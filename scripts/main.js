function AdvectionFilter(e,t){var n=new PIXI.Matrix;e.renderable=!1,PIXI.AbstractFilter.call(this,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform mat3 otherMatrix;","varying vec2 vMapCoord;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","vTextureCoord = aTextureCoord;","vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;","vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),fragmentSource,{mapSampler:{type:"sampler2D",value:e.texture},otherMatrix:{type:"mat3",value:n.toArray(!0)},scale:{type:"v2",value:{x:0,y:0}},flipv:{type:"bool",value:t.flipv},upwind:{type:"bool",value:t.upwind}}),this.maskSprite=e,this.maskMatrix=n;var a=_.get(t,"scale",10);this.scale=new PIXI.Point(a,a);var i=_.get(t,"flipv",!1);this.flipv=i}!function(e,t){"object"==typeof exports?module.exports=t(e,e.document):"function"==typeof define&&define.amd?define(function(){return t(e,e.document)}):e.Sketch=t(e,e.document)}(this,function(e,t){"use strict";function n(e){return"[object Array]"==Object.prototype.toString.call(e)}function a(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"string"==typeof e}function r(e){return C[e]||String.fromCharCode(e)}function s(e,t,n){for(var a in t)!n&&a in e||(e[a]=t[a]);return e}function l(e,t){return function(){e.apply(t,arguments)}}function c(e){var t={};for(var n in e)a(e[n])?t[n]=l(e[n],e):t[n]=e[n];return t}function d(e){function t(t){a(t)&&t.apply(e,[].splice.call(arguments,1))}function n(e){for(U=0;U<ee.length;U++)N=ee[U],o(N)?P[(e?"add":"remove")+"EventListener"].call(P,N,L,!1):a(N)?L=N:P=N}function i(){E(_),_=S(i),q||(t(e.setup),q=a(e.setup)),H||(t(e.resize),H=a(e.resize)),e.running&&!Z&&(e.dt=(F=+new Date)-e.now,e.millis+=e.dt,e.now=F,t(e.update),Q&&(e.retina&&(e.save(),e.scale(Y,Y)),e.autoclear&&e.clear()),t(e.draw),Q&&e.retina&&e.restore()),Z=++Z%e.interval}function l(){P=J?e.style:e.canvas,D=J?"px":"",W=e.width||e.element.width,z=e.height||e.element.height,e.fullscreen&&(z=e.height=w.innerHeight,W=e.width=w.innerWidth),e.retina&&Q&&Y&&(P.style.height=z+"px",P.style.width=W+"px",W*=Y,z*=Y),P.height!==z&&(P.height=z+D),P.width!==W&&(P.width=W+D),q&&t(e.resize)}function d(e,t){return A=t.getBoundingClientRect(),e.x=e.pageX-A.left-(w.scrollX||w.pageXOffset),e.y=e.pageY-A.top-(w.scrollY||w.pageYOffset),e.x*=t.width/A.width,e.y*=t.height/A.height,e}function u(t,n){return d(t,e.element),n=n||{},n.ox=n.x||t.x,n.oy=n.y||t.y,n.x=t.x,n.y=t.y,n.dx=n.x-n.ox,n.dy=n.y-n.oy,n}function p(e){if(e.preventDefault(),O=c(e),O.originalEvent=e,O.touches)for(G.length=O.touches.length,U=0;U<O.touches.length;U++)G[U]=u(O.touches[U],G[U]);else G.length=0,G[0]=u(O,K);return s(K,G[0],!0),O}function h(n){for(n=p(n),B=(R=ee.indexOf(V=n.type))-1,e.dragging=/down|start/.test(V)?!0:/up|end/.test(V)?!1:e.dragging;B;)o(ee[B])?t(e[ee[B--]],n):o(ee[R])?t(e[ee[R++]],n):B=0}function m(n){j=n.keyCode,X="keyup"==n.type,te[j]=te[r(j)]=!X,t(e[n.type],n)}function f(n){e.autopause&&("blur"==n.type?k:v)(),t(e[n.type],n)}function v(){e.now=+new Date,e.running=!0}function k(){e.running=!1}function $(){(e.running?k:v)()}function I(){Q&&e.clearRect(0,0,e.width,e.height)}function T(){M=e.element.parentNode,U=b.indexOf(e),M&&M.removeChild(e.element),~U&&b.splice(U,1),n(!1),k()}var _,L,P,M,A,U,D,F,N,O,V,j,X,B,R,W,z,Z=0,G=[],H=!1,q=!1,Y=w.devicePixelRatio||1,J=e.type==y,Q=e.type==g,K={x:0,y:0,ox:0,oy:0,dx:0,dy:0},ee=[e.element,h,"mousedown","touchstart",h,"mousemove","touchmove",h,"mouseup","touchend",h,"click",h,"mouseout",h,"mouseover",x,m,"keydown","keyup",w,f,"focus","blur",l,"resize"],te={};for(j in C)te[C[j]]=!1;return s(e,{touches:G,mouse:K,keys:te,dragging:!1,running:!1,millis:0,now:NaN,dt:NaN,destroy:T,toggle:$,clear:I,start:v,stop:k}),b.push(e),e.autostart&&v(),n(!0),l(),i(),e}for(var u,p,h="E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min".split(" "),m="__hasSketch",f=Math,g="canvas",v="webgl",y="dom",x=t,w=e,b=[],k={fullscreen:!0,autostart:!0,autoclear:!0,autopause:!0,container:x.body,interval:1,globals:!0,retina:!1,type:g},C={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},$={CANVAS:g,WEB_GL:v,WEBGL:v,DOM:y,instances:b,install:function(e){if(!e[m]){for(var t=0;t<h.length;t++)e[h[t]]=f[h[t]];s(e,{TWO_PI:2*f.PI,HALF_PI:f.PI/2,QUATER_PI:f.PI/4,random:function(e,t){return n(e)?e[~~(f.random()*e.length)]:(i(t)||(t=e||1,e=0),e+f.random()*(t-e))},lerp:function(e,t,n){return e+n*(t-e)},map:function(e,t,n,a,i){return(e-t)/(n-t)*(i-a)+a}}),e[m]=!0}},create:function(e){return e=s(e||{},k),e.globals&&$.install(self),u=e.element=e.element||x.createElement(e.type===y?"div":"canvas"),p=e.context=e.context||function(){switch(e.type){case g:return u.getContext("2d",e);case v:return u.getContext("webgl",e)||u.getContext("experimental-webgl",e);case y:return u.canvas=u}}(),e.exists||(e.container||x.body).appendChild(u),$.augment(p,e)},augment:function(e,t){return t=s(t||{},k),t.element=e.canvas||e,t.element.className+=" sketch",s(e,t,!0),d(e)}},I=["ms","moz","webkit","o"],T=self,_=0,L="AnimationFrame",P="request"+L,M="cancel"+L,S=T[P],E=T[M],A=0;A<I.length&&!S;A++)S=T[I[A]+"Request"+L],E=T[I[A]+"Cancel"+L];return T[P]=S=S||function(e){var t=+new Date,n=f.max(0,16-(t-_)),a=setTimeout(function(){e(t+n)},n);return _=t+n,a},T[M]=E=E||function(e){clearTimeout(e)},$}),L.ImageOverlay.Canvas=L.ImageOverlay.extend({includes:L.Mixin.Events,options:{width:1024,height:1024},initialize:function(e,t){"use strict";this._bounds=L.latLngBounds(e),L.Util.setOptions(this,t)},_initImage:function(){"use strict";var e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),t=this._map.latLngToLayerPoint(this._bounds.getSouthEast()),n=t._subtract(e);this._image=this.canvas=L.DomUtil.create("canvas","leaflet-image-layer"),this.options.id&&(this._image.id=this.options.id),this._image.width=this.options.width||n.x,this._image.height=this.options.width||n.y,this._map.options.zoomAnimation&&L.Browser.any3d?L.DomUtil.addClass(this._image,"leaflet-zoom-animated"):L.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),L.Util.extend(this._image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.Util.bind(this._onImageLoad,this)})},_reset:function(){"use strict";var e=this._image,t=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),n=this._map.latLngToLayerPoint(this._bounds.getSouthEast()),a=n._subtract(t);e.width=this.options.width||a.x,e.height=this.options.width||a.y,L.DomUtil.setPosition(e,t),e.style.width=a.x+"px",e.style.height=a.y+"px"},_onImageLoad:function(){"use strict";this.fire("load")}}),L.imageOverlay.canvas=function(e,t){"use strict";return new L.ImageOverlay.Canvas(e,t)};var bus=new Vue;!function(){"use strict";Vue.component("map-controls",{template:"#map-controls-template",props:{map:Object},data:function(){return{locked:!0}},watch:{locked:"lockedChanged"},ready:function(){var e=this;$("#lockmap").on("switchChange.bootstrapSwitch",function(){$("#lockmap").is(":checked")?e.locked=!0:e.locked=!1})},methods:{lockedChanged:function(e,t){t?this.lockMap():this.unlockMap()},lockMap:function(){var e=this.map;e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable(),$("#lockmap").bootstrapSwitch("state",!0,!0),$("#mapban").removeClass("hide")},unlockMap:function(){var e=this.map;e.dragging.enable(),e.touchZoom.enable(),e.doubleClickZoom.enable(),e.scrollWheelZoom.enable(),e.tap&&e.tap.enable(),$("#lockmap").bootstrapSwitch("state",!1,!0),$("#mapban").addClass("hide")}}}),Vue.component("map-container",{template:'<div id="map" :class="{\'sidebar-map\': sidebar}"></div>',props:{model:Object,map:Object,sidebar:{type:Boolean,"default":function(){return!0}}},data:function(){return{layers:[]}},ready:function(){this.createMap()},methods:{createMap:function(){L.mapbox.accessToken="pk.eyJ1Ijoic2lnZ3lmIiwiYSI6Il8xOGdYdlEifQ.3-JZpqwUa3hydjAJFXIlMA";var e=L.mapbox.map("map","siggyf.c74e2e04");this.sidebar&&L.control.sidebar("sidebar").addTo(e);var t=L.Control.extend({options:{position:"topright"},onAdd:function(){var e=L.DomUtil.create("div","my-custom-control leaflet-control leaflet-bar"),t=$('<a id="drawtoggle"></a>');t.append($('<span class="fa-stack"><i class="fa fa-paint-brush fa-stack-1x"></i><i id="drawingban" class="hide fa fa-ban fa-stack-2x"></i></span>')),t.on("click",function(){sketch.painting=!sketch.painting,sketch.painting?($("#drawing").addClass("crosshair"),$("#drawingban").addClass("hide")):($("#drawing").removeClass("crosshair"),$("#drawingban").removeClass("hide"))}),$(e).append(t);var n=$('<a id="maptoggle"></a>');return n.append($('<span class="fa-stack"><i class="fa fa-map-o fa-stack-1x"></i><i id="mapban" class="fa hide fa-ban fa-stack-2x"></i></span>')),n.on("click",function(){app.$refs.mapControls.locked=!app.$refs.mapControls.locked}),$(e).append(n),e}}),n=new t({});n.addTo(e),this.$set("map",e)},loadModel:function(){for(var e=this.layers,t=this.map,n=this.model;e.length;){var a=e.pop();console.log("destroying layer",a),_.has(a,"canvas.__vue__")&&a.canvas.__vue__.$destroy(),t.removeLayer(a)}var i=L.latLng(n.extent.sw[0],n.extent.sw[1]),o=L.latLng(n.extent.ne[0],n.extent.ne[1]),r=L.latLngBounds(i,o);t.fitBounds(r,{animate:!0});var s=L.imageOverlay.canvas(r,{id:"webgl"}).addTo(t);e.push(s);var l=L.imageOverlay.canvas(r,{id:"drawing"}).addTo(t);e.push(l),bus.$emit("model-layer-added",{drawingElement:l.canvas,modelElement:s.canvas,modelLayer:s,model:n}),bus.$emit("drawing-layer-added",{drawingElement:l.canvas,drawingLayer:l,model:n,map:t});var c=new CustomEvent("model-layers",{detail:n});document.dispatchEvent(c)}}})}();var fragmentSource=["precision mediump float;","varying vec2 vMapCoord;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 scale;","uniform bool flipv;","uniform bool upwind;","uniform sampler2D uSampler;","uniform sampler2D mapSampler;","void main(void)","{","vec4 map =  texture2D(mapSampler, vMapCoord);","float extrascale = 1.0;","map -= 0.5;","map.xy *= (scale * extrascale);","if (flipv) {","map.y = - map.y;","}","vec2 lookup = vec2(vTextureCoord.x - map.x, vTextureCoord.y - map.y);","if (upwind) {"," vec4 vUpwind = texture2D(mapSampler, vec2(vMapCoord.x - map.x, vMapCoord.y - map.y ));"," vUpwind -= 0.5;"," if (flipv) {","  vUpwind.y = - vUpwind.y;"," }"," vUpwind.xy *= scale *extrascale;"," /* overwrite lookup with upwind */"," lookup = vec2(vTextureCoord.x - 0.5*(map.x + vUpwind.x), vTextureCoord.y - 0.5* (map.y + vUpwind.y));","}","/* stop rendering if masked */","gl_FragColor = texture2D(uSampler, lookup);","if (map.z > 0.0) {","gl_FragColor *= 0.0;","}","}"].join("\n");AdvectionFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),AdvectionFilter.prototype.constructor=AdvectionFilter,AdvectionFilter.prototype.applyFilter=function(e,t,n){var a=e.filterManager;a.calculateMappedMatrix(t.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/t.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/t.frame.height),this.uniforms.flipv.value=this.flipv;var i=this.getShader(e);a.applyFilter(i,t,n)},Object.defineProperties(AdvectionFilter.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(e){this.uniforms.mapSampler.value=e}}});var sketch;!function(){"use strict";Vue.component("drawing-controls",{template:"#drawing-controls-template",props:["sketch"],data:function(){return{}}});var e=Vue.component("drawing-canvas",{data:function(){return{layer:null,sketch:null}},ready:function(){this.addDrawing()},methods:{clear:function(){this.sketch.clear()},addDrawing:function(){sketch=Sketch.create({element:this.$el,container:null,autoclear:!1,fullscreen:!1,exists:!0,palette:["black","white"],radius:3,painting:!0,hasDragged:!0,setup:function(){},update:function(){},keydown:function(){},mouseup:function(){this.hasDragged||(this.painting=!this.painting,this.painting?($("#drawing").addClass("crosshair"),$("#drawingban").addClass("hide")):($("#drawing").removeClass("crosshair"),$("#drawingban").removeClass("hide")))},mousedown:function(){this.hasDragged=!1},mousemove:function(){this.hasDragged=!0},click:function(){},touchmove:function(){if(this.painting)for(var e,t=this.touches.length-1;t>=0;t--)e=this.touches[t],this.lineCap="round",this.lineJoin="round",this.strokeStyle=this.palette[Math.floor(Math.random()*this.palette.length)],this.lineWidth=this.radius,this.beginPath(),this.moveTo(e.ox,e.oy),this.lineTo(e.x,e.y),this.stroke()}}),this.$set("sketch",sketch),bus.$emit("sketch-created",sketch)}}});bus.$on("drawing-layer-added",function(t){var n=new e({_ref:"drawingCanvas",data:{layer:t.drawingLayer},el:t.drawingElement,parent:app});bus.$emit("drawing-canvas-created",n)}),$(function(){$("#images a.thumbnail").click(function(e){var t=$(e.currentTarget).find("img").attr("src"),n=new Image;n.onload=function(){sketch.drawImage(n,0,0)},n.src=t,e.preventDefault()})})}(),function(){"use strict";Vue.component("model-details",{template:"#model-details-template",props:["model"],data:function(){return{}}}),Vue.component("models-overview",{template:"#models-overview-template",data:function(){return{models:[]}},ready:function(){var e=this;fetch("data/models.json").then(function(e){return e.json()}).then(function(t){e.models=t.models,e.selectModel(e.models[0])})["catch"](function(e){console.log("parsing failed",e)})},methods:{selectModel:function(e){var t=new CustomEvent("model-selected",{detail:e});document.dispatchEvent(t),bus.$emit("model-selected",e)}}})}(),function(){"use strict";function e(e,t,n){this.canvas=t,this.width=t.width,this.height=t.height,this.canvasIcon=$("#canvas-icon")[0],this.drawIcon(),this.model=e,this.icon="images/bar.png",this.particleAlpha=.6,this.tailLength=0,this.replace=!0,this.particles=[],this.sprites=new PIXI.ParticleContainer(0,{scale:!0,position:!0,rotation:!0,uvs:!0,alpha:!0}),n.addChild(this.sprites),this.counter=0,this.iconTexture=null}e.prototype.drawIcon=function(){var e=this.canvasIcon.getContext("2d");e.clearRect(0,0,10,10),e.strokeStyle="white",e.strokeWidth=.01,e.beginPath(),e.ellipse(5,5,2,5,0,0,2*Math.PI),e.stroke(),this.iconTexture&&this.iconTexture.update()},e.prototype.create=function(){this.iconTexture=PIXI.Texture.fromCanvas(this.canvasIcon);var e=new PIXI.Sprite(this.iconTexture);return e.anchor.set(.5),e.alpha=this.particleAlpha,e.x=Math.random()*this.width,e.y=Math.random()*this.height,e.tail=[],e},e.prototype.clear=function(){this.particles=[],this.sprites.removeChildren()},e.prototype.culling=function(e){for(var t=this.particles.length,n=e,a=t-1;a>=n;a--)_.pullAt(this.particles,a),this.sprites.removeChildAt(a);for(var i=0;n-t>i;i++){var o=this.create();this.particles.push(o),this.sprites.addChild(o)}},e.prototype.step=function(){var e=this;if(this.particles.length){var t=$("#uv")[0];if(!t.paused&&!t.ended){var n=$("#drawing")[0],a=n.getContext("2d");a.strokeStyle="rgba(255, 255, 255, 0.1)";var i=$("#uvhidden")[0],o=i.getContext("2d"),r=i.width,s=i.height;o.drawImage(t,0,0,r,s);var l=o.getImageData(0,0,r,s);_.each(this.particles,function(t){var n=4*(Math.round(s-t.position.y)*r+Math.round(t.position.x)),i=l.data[n+0]/255-.5,o=l.data[n+1]/255-.5;o*=e.model.flipv?-1:1;var c=l.data[n+2]/255>.5;c=c||Math.abs(i)+Math.abs(o)===0,t.position.x=t.position.x+i*e.model.scale,t.position.y=t.position.y+o*e.model.scale,c=c||t.position.x>r,c=c||t.position.x<0,c=c||t.position.y>s,c=c||t.position.y<0,c=c||isNaN(t.position.x),c=c||isNaN(t.position.y);var d=Math.atan2(o,i)-.5*Math.PI,u=d-t.rotation,p=.1;if(Math.abs(u)>p&&(u=u>0?p:-p),t.rotation+=u,c&&(_.pull(e.particles,t),e.sprites.removeChild(t),e.replace)){var h=e.create();e.particles.push(h),e.sprites.addChild(h)}if(e.particles.length<300){if(e.counter%10===0)for(t.tail.push(_.clone(t.position));t.tail.length>e.tailLength;)t.tail.shift();if(t.tail.length>0){a.beginPath(),a.moveTo(t.tail[0].x,t.tail[0].y);for(var m=1;m<t.tail.length;m++)a.lineTo(t.tail[m].x,t.tail[m].y);a.stroke()}}},this),this.counter++}}},Vue.component("particle-component",{template:"#particle-component-template",props:["model","sketch","pipeline"],data:function(){return{}},ready:function(){},watch:{model:"resetParticles",sketch:"resetParticles"},methods:{resetParticles:function(){return _.isNil(this.sketch)?void console.warn("no canvas, no particles",this.sketch):_.isNil(this.pipeline)?void console.warn("no pipeline, no particles",this.pipeline):void(this.model.particles=new e(this.model,this.sketch.element,this.pipeline))},addParticles:function(){if(console.log("adding particles"),!_.isNil(this.model.particles)){var e=this.model.particles;e.culling(e.particles.length+50)}},removeParticles:function(){this.model.particles.culling(0)}}})}(),function(){"use strict";Vue.component("uv-source",{template:"#uv-source-template",props:["model"],data:function(){return{loaded:!1}},watch:{model:"modelUpdate"},ready:function(){},methods:{modelUpdate:function(){var e=this;this.loaded=!1,this.$nextTick(function(){if(console.log("watching video for load"),"video"!==e.model.uv.tag)return void console.log("no video model",e.model.uv);var t=$(e.$el).find("video").first();t[0].currentTime=t[0].currentTime,t.bind("loadeddata",function(){console.log("video loaded"),e.loaded=!0,e.$set("model.duration",t[0].duration)}),t.bind("timeupdate",function(){e.$set("model.currentTime",t[0].currentTime)})})}}});var e=Vue.component("model-canvas",{data:function(){return{model:null,modelElement:null,drawingElement:null,renderTextureFrom:null,renderTextureTo:null,pipeline:null}},ready:function(){this.createContext()},methods:{clear3d:function(){this.renderTextureTo.clear(),this.renderTextureFrom.clear()},createContext:function(){function e(){requestAnimationFrame(e),m.scale.y=-1,d.update(),o.render(r),y.render(r,null,!0),$("#cleardrawing").is(":checked")&&c.clearRect(0,0,l.width,l.height),v.texture=y;var n=g;g=y,y=n,y.clear(),_.isNil(t.particles)||(t.particles.step(),t.particles.particles.length>500&&g.clear())}console.log("creating new canvas context");var t=this.model,n=$("#webgl")[0],a=n.width,i=n.height,o=new PIXI.WebGLRenderer(a,i,{view:n,transparent:!0}),r=new PIXI.Container,s=new PIXI.Container;r.addChild(s);var l=this.drawingElement,c=l.getContext("2d"),d=PIXI.Texture.fromCanvas(l),u=new PIXI.Sprite(d),p=document.getElementById("uv"),h=PIXI.Texture.fromVideo(p),m=new PIXI.Sprite(h);m.width=a,m.height=i;var f=new AdvectionFilter(m,{scale:t.scale,flipv:t.flipv,upwind:!1});r.addChild(m),s.filters=[f];var g=new PIXI.RenderTexture(o,a,i),v=new PIXI.Sprite(g),y=new PIXI.RenderTexture(o,a,i);s.addChild(v),s.addChild(u),this.pipeline=s,bus.$emit("pipeline-created",s),e(),this.$set("renderTextureFrom",g),this.$set("renderTextureTo",y),$("#clear3d").click(this.clear3d)}}});bus.$on("model-layer-added",function(t){var n=new e({_ref:"modelCanvas",data:{layer:t.modelLayer,modelElement:t.modelElement,drawingElement:t.drawingElement,model:t.model},el:t.modelElement,parent:app});console.log("modelCanvas",n)})}(),function(){"use strict";function e(){var e=[];d3.selectAll("circle.active").each(function(t){var n=d3.rgb(255*t.rgb[0],255*t.rgb[1],255*t.rgb[2]);e.push(n)}),_.isNil(sketch)||(sketch.palette=e)}Vue.component("painting-palettes",{template:"#paintings-template",data:function(){return{paintings:[]}},ready:function(){var e=this;fetch("data/paintings.json").then(function(e){return e.json()}).then(function(t){e.paintings=t,e.select(e.paintings[0])})},methods:{select:function(e){bus.$emit("palette-selected",e.palette)}}}),Vue.component("palette-chart",{template:"#palette-chart-template",data:function(){return{}},props:{palette:{type:Array,"default":function(){return[]}}},ready:function(){this.$watch("palette",function(){this.updateChart()})},methods:{updateChart:function(){var t=300,n=200,a=d3.select("#palette").select("svg"),i=a.select("g");a.attr("width",t).attr("height",n);var o=d3.scaleLinear().range([0,t]).domain([-.1,1.1]).nice(),r=d3.scaleLinear().range([n,0]).domain([-.1,1.1]).nice();i.selectAll("circle").remove(),i.selectAll("circle").data(this.palette).enter().append("circle").attr("cx",function(e){return o(e.x)}).attr("cy",function(e){return r(e.y)}).attr("r",10).style("fill",function(e){return d3.rgb(255*e.rgb[0],255*e.rgb[1],255*e.rgb[2])}).on("click",function(){d3.select(this).classed("active",!d3.select(this).classed("active")),e()}),i.selectAll("circle").classed("active",!0),e()}}}),document.addEventListener("model-loaded",function(){e()})}(),function(){"use strict";Vue.component("key-bindings",{template:"<div></div>",data:function(){var e=this.$root;return{keyBindings:[{key:"p",method:e.$refs.particleComponent.addParticles,arguments:{}},{key:"c",method:this.clear,arguments:{}}]}},ready:function(){window.addEventListener("keyup",this.keyUp)},methods:{keyUp:function(e){var t=_.first(_.filter(this.keyBindings,["key",e.key]));_.isNil(t)||t.method(t.arguments)},clear:function(){var e=this.$root;e.$refs.particleComponent.removeParticles(),e.$refs.drawingCanvas.clear(),e.$refs.modelCanvas.clear3d()}}})}(),function(){"use strict";Vue.component("story-container",{template:"#story-container-template",data:function(){return{storyUrl:"data/stories/tutorial.json",story:null}},ready:function(){var e=this,t=new ScrollMagic.Controller({container:this.$el}),n=this.$root;fetch(this.storyUrl).then(function(e){return e.json()}).then(function(a){e.$set("story",a),e.$nextTick(function(){var a=e.$el.getElementsByClassName("story-item");console.log("story elements",a,a.length),_.each(a,function(e){var a=e.__v_frag.raw,i=new ScrollMagic.Scene({triggerElement:e,duration:e.clientHeight}).addTo(t).on("enter",function(){_.has(a,"latlng")&&n.map.setView(a.latlng,a.zoom)}).addIndicators();console.log("add scene",i)})})})}})}(),function(){"use strict";Vue.component("chart-container",{template:"#chart-container-template",props:["model"],data:function(){return{url:"data/stories/data/denhelder.json",chart:null}},ready:function(){console.log("create chart in ",this.$el),this.$nextTick(function(){var e={top:10,right:10,bottom:20,left:10},t=this.$el.clientWidth-e.left-e.right,n=this.$el.clientHeight-e.top-e.bottom,a=d3.scaleTime().range([0,t]),i=d3.scaleLinear().range([0,t]),o=d3.scaleLinear().range([n,0]),r=d3.scaleLinear().range([n,0]),s=d3.select(this.$el).append("svg");s.attr("width",t+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),d3.json(this.url,function(e){console.log("got data",e.length),a.domain(d3.extent(e,function(e){return d3.isoParse(e.date)})),r.domain(d3.extent(e,function(e){return e.h}));var t=d3.line().x(function(e){return a(d3.isoParse(e.date))}).y(function(e){return r(e.h)});s.datum(e).append("path").attr("class","line waterlevel").attr("d",t),s.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+n+")").call(d3.axisBottom(a)),s.append("g").attr("class","axis axis--y").call(d3.axisLeft(r)).append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end")});var l=[{x:this.progress,y:0},{x:this.progress,y:1}],c=d3.line().x(function(e){return i(e.x)}).y(function(e){return o(e.y)}),d=s.datum(l).append("path").attr("class","line").attr("d",c);this.chart={pathProgress:d,lineProgress:c,xLinear:i,xTime:a,y:o,svg:s}})},watch:{progress:function(e){var t=[{x:e,y:0},{x:e,y:1}];this.chart.pathProgress.datum(t).attr("d",this.chart.lineProgress)}},computed:{progress:{cache:!1,get:function(){if(!_.has(this.model,"currentTime"))return 0;var e=this.model.currentTime/this.model.duration;return e}}}})}();var app;!function(){"use strict";function e(){for(var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,a=function(e){return decodeURIComponent(e.replace(t," "))},i=window.location.search.substring(1),o={};null!==(e=n.exec(i));)o[a(e[1])]="true"===a(e[2]);return o}app=new Vue({el:"#app",ready:function(){this.$nextTick(function(){$('input[type="checkbox"]').bootstrapSwitch()})},data:function(){var t=e(),n={settings:{sidebar:!0,story:!1,chart:!1},palette:[],pipeline:{},model:null,map:null,sketch:null};return _.assign(n.settings,t),n},methods:{}}),bus.$on("model-selected",function(e){app.$set("model",e),Vue.nextTick(function(){console.log("uv source",app.$refs.uvSource.model),app.$refs.mapContainer.loadModel(e)})}),bus.$on("palette-selected",function(e){app.$set("palette",e)}),bus.$on("model-layer-added",function(){}),bus.$on("sketch-created",function(e){app.$set("sketch",e)}),bus.$on("pipeline-created",function(e){app.$set("pipeline",e)}),Vue.config.debug=!0}();